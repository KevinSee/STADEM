<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STADEM • STADEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="STADEM">
<meta property="og:description" content="STADEM">
<meta property="og:image" content="https://kevinsee.github.io/STADEM/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">STADEM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/STADEM-vignette.html">STADEM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KevinSee/STADEM/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="STADEM-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="STADEM-vignette_files/kePrint-0.0.1/kePrint.js"></script><link href="STADEM-vignette_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>STADEM</h1>
                        <h4 class="author">Kevin E. See</h4>
            
            <h4 class="date">2021-09-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/KevinSee/STADEM/blob/master/vignettes/STADEM-vignette.Rmd"><code>vignettes/STADEM-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>STADEM-vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The STADEM package was developed with the goal of estimating total adult escapement of spring/summer Chinook salmon and steelhead that cross Lower Granite dam (LGD). In addition, to meet desired management and research objectives, total escapement has to include estimates of uncertainty and be parsed into weekly strata by three origin groups; wild, hatchery and hatchery no-clip. To reach this goal, we have developed the <strong>ST</strong>ate space <strong>A</strong>dult <strong>D</strong>am <strong>E</strong>scapement <strong>M</strong>odel (STADEM) model that incorporates fish ladder window counts, data from sampled fish at the LGD adult trap, and observations of previously PIT tagged fish at LGD adult detection sites.</p>
<p>Some of the data needed for STADEM is available at other dams, and the package developers are currently working to develop the ability to query all of the necessary data at other locations. Currently however, the focus remains on Lower Granite dam, the furthest upstream dam returning salmonids encounter on the journey up the Snake River. The following example will show how to run STADEM at Lower Granite for one species and one year, and what some of the output looks like.</p>
</div>
<div id="system-requirements" class="section level1">
<h1 class="hasAnchor">
<a href="#system-requirements" class="anchor"></a>System requirements</h1>
<p>STADEM relies on the following R packages which can be downloaded via <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">CRAN</a> or by using the function <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>:</p>
<ul>
<li>
<code>dplyr</code>, <code>lubridate</code>, <code>httr</code>: can all be installed by installing the <code>tidyverse</code> package</li>
<li><code>rjags</code></li>
<li><code>jagsUI</code></li>
<li><code>boot</code></li>
</ul>
<p>In addition, STADEM requires the <a href="https://sourceforge.net/projects/mcmc-jags/files/">JAGS software</a> (Just Another Gibbs Sampler). Please download version &gt;= 4.0.0 via the former link.</p>
</div>
<div id="data-sources" class="section level1">
<h1 class="hasAnchor">
<a href="#data-sources" class="anchor"></a>Data sources</h1>
<p>STADEM relies on several pieces of data, which must be compiled from multiple sources. Many of them are accessed through the Columbia Basin Research Data Access in Real Time (<a href="http://www.cbr.washington.edu/dart">DART</a>) website.</p>
<ul>
<li>
<strong>Window counts</strong> are available through DART for many dams within the Columbia River basin.</li>
<li>
<strong>Trap data</strong> comes from an adult fish trap. This provides biological information (e.g., origin, genetic stock, age, sex) to allow the decomposition of total escapement into specific groups, as well as a secondary estimate of total escapement, if the trap rate is known or can be reliably estimated.</li>
<li>
<strong>PIT-tag data</strong> comes from fish that were previously PIT tagged, either as juveniles or as adults at one of the dams downstream of Lower Granite. These fish provide information about the proportion of the run that crosses the dam at night, when the counting window is closed, as well as the proportion of the run that has fallen back and re-ascended the dam. This data is also available through DART.</li>
</ul>
</div>
<div id="high-level-overview" class="section level1">
<h1 class="hasAnchor">
<a href="#high-level-overview" class="anchor"></a>High-level overview</h1>
<p>STADEM estimates the total number of fish crossing the dam each week, based on two major data sources: the window counts and the total fish in the trap, while also accounting for two known biological processes: night-time passage and fallback-and-reascension. Using a state-space approach, STADEM assumes that the window counts and the estimates from the trap (fish in the trap divided by trap rate that week) are generated by processes with observation error. In the case of the window counts, there is some inherent error in the counting process, and it fails to account for fish that cross the dam while the window is closed. In the case of the trap, there is sampling variation and uncertainty in what the realized trap rate is. In addition, STADEM accounts for potential double-counting of fish that have fallen back and re-ascended the dam. It then partitions the estimate of total fish over the dam by origin, to provide the needed data for management goals (Figure @ref(fig:stadem_model_figure)).</p>
<div class="figure">
<img src="STADEM-vignette_files/figure-html/stadem_model_figure-1.png" alt="Schematic of how the STADEM model works. Panel A shows the posterior of the estimate of fish crossing while the window is open (dashed line shows observed window counts). That estimate is divided by the nighttime passage rate (B). The total fish is then discounted by the reascension rate to estimate unique fish (C). Those unique fish are then multiplied by the proportion of wild fish (D), to estimate unique wild fish." width="576"><p class="caption">
Schematic of how the STADEM model works. Panel A shows the posterior of the estimate of fish crossing while the window is open (dashed line shows observed window counts). That estimate is divided by the nighttime passage rate (B). The total fish is then discounted by the reascension rate to estimate unique fish (C). Those unique fish are then multiplied by the proportion of wild fish (D), to estimate unique wild fish.
</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div id="compiling-data" class="section level1">
<h1 class="hasAnchor">
<a href="#compiling-data" class="anchor"></a>Compiling data</h1>
<p>The STADEM package relies on many functions from two other packages, <code>tidyverse</code> for many data manipulation functions and <code>lubridate</code> for dates and intervals. It also depends upon the <code>jagsUI</code> package to run the JAGS program from within R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/KevinSee/STADEM">STADEM</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kenkellner/jagsUI">jagsUI</a></span><span class="op">)</span></code></pre></div>
<p>The STADEM package makes it easy to compile all the necessary data in one convenient function, <code>compileGRAdata</code>. The user provides the spawn year and species (either “Chinook” or “Steelhead”) they are interested in. STADEM operates on a weekly time-step, and the user has the option to determine the day of the week that most strata will begin on, using the <code>strata_beg</code> argument. There are periodic messages describing what is being done within <code>compileGRAdata</code>. Within <code>compileGRAdata</code>, several internal functions are being called, which may be utilized with the STADEM package for other purposes. They include:</p>
<ul>
<li>
<code>getWindowCounts</code>: query DART for window counts at various dams</li>
<li>
<code>queryPITtagData</code>: query DART for data about PIT tags exhibiting night-time passage and fallback/reascension behavior</li>
<li>
<code>weeklyStrata</code>: divide season into weekly strata, with the user defining the day of the week each strata should begin with</li>
<li>
<code>summariseLGRtrapDaily</code>: summarize on a daily time-step the .csv file contained within the Lower Granite Dam trap database</li>
<li>
<code>tagTrapRate</code>: estimate the fish trap rate based on proportion of PIT tags known to have crossed the dam were caught in the adult trap</li>
<li>
<code>queryTrapRate</code>: query DART for intended and realized trap rates, based on time the trap is open</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># what spawning year? (2010 - 2016)</span>
<span class="va">yr</span> <span class="op">=</span> <span class="fl">2014</span>

<span class="co"># what species?</span>
<span class="va">spp</span> <span class="op">=</span> <span class="st">'Chinook'</span>

<span class="co"># pull together all data</span>
<span class="va">stadem_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/compileGRAdata.html">compileGRAdata</a></span><span class="op">(</span>spp <span class="op">=</span> <span class="va">spp</span>,
                             start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">yr</span>, <span class="st">'0301'</span><span class="op">)</span>,
                             end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">yr</span>, <span class="st">'0817'</span><span class="op">)</span>,
                             strata_beg <span class="op">=</span> <span class="st">'Mon'</span>,
                             trap_dbase <span class="op">=</span> <span class="fu"><a href="../reference/readLGRtrapDB.html">readLGRtrapDB</a></span><span class="op">(</span><span class="st">'../inst/extdata/Chnk2014_TrapDatabase.csv'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/compileGRAdata.html">compileGRAdata()</a></code> function returns several pieces of information, consolidated into a named list we have called <code>stadem_list</code>:</p>
<ul>
<li>
<code>weekStrata</code>: weekly strata for STADEM, which are <code>interval</code> objects from the <code>lubridate</code> package.</li>
<li>
<code>trapData</code>: data from adult fish trap.</li>
<li>
<code>dailyData</code>: data.frame of data, summarized by day.</li>
<li>
<code>weeklyData</code>: data.frame of data, summarized by weekly strata.</li>
</ul>
<p>To run STADEM, only <code>weeklyData</code> is needed. STADEM also includes a function to transform all relevant data from the weekly summary to a list ready to be passed to JAGS.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compile everything into a list to pass to JAGS</span>
<span class="va">jags_data_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/prepJAGS.html">prepJAGS</a></span><span class="op">(</span><span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## Prepping JAGS data</code></pre>
</div>
<div id="run-stadem" class="section level1">
<h1 class="hasAnchor">
<a href="#run-stadem" class="anchor"></a>Run STADEM</h1>
<p>Part of the function <code>runJAGSmodel</code> writes the JAGS model as a text file. This requires a filename, and the type of statistical distribution the user would like to use to model the window counts. The options are Poisson (<code>pois</code>), negative binomial (<code>neg_bin</code>), a more flexible type of negative binomial, described in <span class="citation">Lindén and Mäntyniemi (2011)</span> (<code>neg_bin2</code>), quasi-Poisson (<code>quasi_pois</code>), or as a normal distribution in log-space (<code>log_space</code>). Once those have been set, use the <code>runSTADEMmodel</code> function to run the model in JAGS. Some of the inputs to this function are:</p>
<ul>
<li>
<code>file_name</code> name of text file to write the JAGS model to (should end in .txt)</li>
<li>
<code>mcmc_chainlength</code> total length of MCMC chain</li>
<li>
<code>mcmc_burn</code> length of burn-in period for MCMC chain</li>
<li>
<code>mcmc_thin</code> thinning rate for with samples of MCMC chain to keep</li>
<li>
<code>mcmc_chains</code> how many independent chains to run</li>
<li>
<code>jags_data</code> list of data compiled for JAGS, returned by <code>prepJAGS</code> function</li>
<li>
<code>seed</code> input to <code>set.seed</code> function to make the results exactly reproducible</li>
<li>
<code>weekly_params</code> Should weekly estimates of escapement be saved, or only season-wide totals?</li>
<li>
<code>win_model</code> statistical distribution used to model the window counts</li>
<li>
<code>trap_est</code> if set to <code>FALSE</code>, the estimate of escapement from the trap and trap rate is not used, and <code>win_model</code> is automatically set to Poisson.</li>
</ul>
<div id="suggestions" class="section level2">
<h2 class="hasAnchor">
<a href="#suggestions" class="anchor"></a>Suggestions</h2>
<p>Recommended MCMC parameters are:</p>
<ul>
<li>
<code>mcmc_chains</code>: 4</li>
<li>
<code>mcmc_chainLength</code>: 40,000</li>
<li>
<code>mcmc_burn</code>: 10,000</li>
<li>
<code>mcmc_thin</code>: 30</li>
</ul>
<p>This provides a sample of 4,000 draws from the posterior distribution. Through trial and error, we have also determined the appropriate burn-in length and thinning interval to meet MCMC posterior checks.</p>
<p>We also recommend using the negative binomial distribution (<code>win_model = neg_bin</code>) to model the window counts. In our experience, all options other than the Poisson distribution provide similar estimates, with similar estimates of uncertainty. The Poisson distribution does not allow for the possibility of overdispersion in the window count data, leading to smaller uncertainty estimates which may not be appropriate. However, we encourage investigation of how different distribution choices may affect estimates for particular datasets, and for users to critically consider the appropriate modeling choice.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># name of JAGS model to write</span>
<span class="va">model_file_nm</span> <span class="op">=</span> <span class="st">'STADEM_JAGS_model.txt'</span>

<span class="co"># what distribution to use for window counts?</span>
<span class="va">win_model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'pois'</span>, <span class="st">'neg_bin'</span>, <span class="st">'neg_bin2'</span>, <span class="st">'quasi_pois'</span>, <span class="st">'log_space'</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>

<span class="co">#-----------------------------------------------------------------</span>
<span class="co"># run STADEM model</span>
<span class="co">#-----------------------------------------------------------------</span>
<span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/runSTADEMmodel.html">runSTADEMmodel</a></span><span class="op">(</span>file_name <span class="op">=</span> <span class="va">model_file_nm</span>,
                     mcmc_chainLength <span class="op">=</span> <span class="fl">40000</span>,
                     mcmc_burn <span class="op">=</span> <span class="fl">10000</span>,
                     mcmc_thin <span class="op">=</span> <span class="fl">30</span>,
                     mcmc_chains <span class="op">=</span> <span class="fl">4</span>,
                     jags_data <span class="op">=</span> <span class="va">jags_data_list</span>,
                     seed <span class="op">=</span> <span class="fl">5</span>,
                     weekly_params <span class="op">=</span> <span class="cn">T</span>,
                     win_model <span class="op">=</span> <span class="va">win_model</span>,
                     trap_est <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Running JAGS model</code></pre>
</div>
</div>
<div id="stadem-output" class="section level1">
<h1 class="hasAnchor">
<a href="#stadem-output" class="anchor"></a>STADEM output</h1>
<p>The JAGS object returned by <code>runSTADEMmodel</code> contains many parameter estimates. Some of the most important are the total escapement of various fish.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">'X.tot'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu">kbl</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">T</span>,
      linesep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
2.5%
</th>
<th style="text-align:right;">
25%
</th>
<th style="text-align:right;">
50%
</th>
<th style="text-align:right;">
75%
</th>
<th style="text-align:right;">
97.5%
</th>
<th style="text-align:right;">
Rhat
</th>
<th style="text-align:right;">
n.eff
</th>
<th style="text-align:right;">
overlap0
</th>
<th style="text-align:right;">
f
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
X.tot.all
</td>
<td style="text-align:right;">
116839.878
</td>
<td style="text-align:right;">
4310.8681
</td>
<td style="text-align:right;">
108312.875
</td>
<td style="text-align:right;">
113971.500
</td>
<td style="text-align:right;">
116820.500
</td>
<td style="text-align:right;">
119732.750
</td>
<td style="text-align:right;">
125156.325
</td>
<td style="text-align:right;">
1.0019806
</td>
<td style="text-align:right;">
1036
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.day
</td>
<td style="text-align:right;">
108801.596
</td>
<td style="text-align:right;">
3993.2570
</td>
<td style="text-align:right;">
100822.900
</td>
<td style="text-align:right;">
106198.250
</td>
<td style="text-align:right;">
108770.000
</td>
<td style="text-align:right;">
111554.250
</td>
<td style="text-align:right;">
116491.975
</td>
<td style="text-align:right;">
1.0023658
</td>
<td style="text-align:right;">
882
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.night
</td>
<td style="text-align:right;">
8038.282
</td>
<td style="text-align:right;">
666.0799
</td>
<td style="text-align:right;">
6844.000
</td>
<td style="text-align:right;">
7589.750
</td>
<td style="text-align:right;">
8004.000
</td>
<td style="text-align:right;">
8439.000
</td>
<td style="text-align:right;">
9442.000
</td>
<td style="text-align:right;">
1.0009449
</td>
<td style="text-align:right;">
2251
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.reasc
</td>
<td style="text-align:right;">
7754.921
</td>
<td style="text-align:right;">
629.6417
</td>
<td style="text-align:right;">
6616.800
</td>
<td style="text-align:right;">
7319.000
</td>
<td style="text-align:right;">
7719.000
</td>
<td style="text-align:right;">
8153.250
</td>
<td style="text-align:right;">
9119.075
</td>
<td style="text-align:right;">
0.9999071
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.new.all
</td>
<td style="text-align:right;">
109084.957
</td>
<td style="text-align:right;">
4075.9399
</td>
<td style="text-align:right;">
101120.000
</td>
<td style="text-align:right;">
106377.750
</td>
<td style="text-align:right;">
109080.000
</td>
<td style="text-align:right;">
111843.000
</td>
<td style="text-align:right;">
117097.075
</td>
<td style="text-align:right;">
1.0021951
</td>
<td style="text-align:right;">
966
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.new.wild
</td>
<td style="text-align:right;">
29249.577
</td>
<td style="text-align:right;">
1164.1753
</td>
<td style="text-align:right;">
26968.950
</td>
<td style="text-align:right;">
28460.000
</td>
<td style="text-align:right;">
29248.500
</td>
<td style="text-align:right;">
29995.250
</td>
<td style="text-align:right;">
31585.225
</td>
<td style="text-align:right;">
1.0010755
</td>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.new.hatch
</td>
<td style="text-align:right;">
70256.254
</td>
<td style="text-align:right;">
2921.8932
</td>
<td style="text-align:right;">
64480.950
</td>
<td style="text-align:right;">
68259.750
</td>
<td style="text-align:right;">
70251.500
</td>
<td style="text-align:right;">
72311.000
</td>
<td style="text-align:right;">
75809.225
</td>
<td style="text-align:right;">
1.0022491
</td>
<td style="text-align:right;">
985
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.new.hnc
</td>
<td style="text-align:right;">
9578.542
</td>
<td style="text-align:right;">
494.6754
</td>
<td style="text-align:right;">
8641.975
</td>
<td style="text-align:right;">
9250.000
</td>
<td style="text-align:right;">
9564.000
</td>
<td style="text-align:right;">
9901.500
</td>
<td style="text-align:right;">
10583.175
</td>
<td style="text-align:right;">
1.0025053
</td>
<td style="text-align:right;">
1041
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.night.wild
</td>
<td style="text-align:right;">
1996.710
</td>
<td style="text-align:right;">
184.8007
</td>
<td style="text-align:right;">
1684.480
</td>
<td style="text-align:right;">
1872.436
</td>
<td style="text-align:right;">
1981.935
</td>
<td style="text-align:right;">
2102.445
</td>
<td style="text-align:right;">
2393.991
</td>
<td style="text-align:right;">
1.0020758
</td>
<td style="text-align:right;">
1788
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
X.tot.reasc.wild
</td>
<td style="text-align:right;">
2119.104
</td>
<td style="text-align:right;">
189.6965
</td>
<td style="text-align:right;">
1786.000
</td>
<td style="text-align:right;">
1994.000
</td>
<td style="text-align:right;">
2098.000
</td>
<td style="text-align:right;">
2231.000
</td>
<td style="text-align:right;">
2542.100
</td>
<td style="text-align:right;">
1.0001975
</td>
<td style="text-align:right;">
4000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Another table that summarizes some of the output by week can be found by using the code below.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">week_df</span> <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^X.all\\['</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^X.day\\['</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^X.night\\['</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^X.reasc\\['</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'X.new.tot\\['</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
         week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[0-9]+"</span><span class="op">)</span><span class="op">)</span>,
         param <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[:alpha:]+"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tbl_df</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>param <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">param</span>,
                        <span class="st">'all'</span> <span class="op">=</span> <span class="st">'Total'</span>,
                        <span class="st">'day'</span> <span class="op">=</span> <span class="st">'Day'</span>,
                        <span class="st">'night'</span> <span class="op">=</span> <span class="st">'Night'</span>,
                        <span class="st">'reasc'</span> <span class="op">=</span> <span class="st">'Reascension'</span>,
                        <span class="st">'new'</span> <span class="op">=</span> <span class="st">'Unique'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">param</span>, <span class="va">week</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span>

<span class="co"># table with point estimates only</span>
<span class="va">pt_est_tab</span> <span class="op">=</span> <span class="va">week_df</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">sd</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">spread</span><span class="op">(</span><span class="va">param</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
              <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>Week <span class="op">=</span> <span class="va">week</span>,
         Win.Cnt <span class="op">=</span> <span class="va">win_cnt</span>,
         <span class="va">Total</span>,
         <span class="va">Day</span>,
         <span class="va">Night</span>,
         <span class="va">Reascension</span>,
         <span class="va">Unique</span><span class="op">)</span>

<span class="co"># table with point estimates and standard errors</span>
<span class="va">est_tab</span> <span class="op">=</span> <span class="va">week_df</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>prnt_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>, <span class="st">' ('</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">sd</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">')'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">sd</span>, <span class="op">-</span><span class="va">mean</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">spread</span><span class="op">(</span><span class="va">param</span>, <span class="va">prnt_val</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span>
              <span class="fu">mutate</span><span class="op">(</span>week <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span>Week <span class="op">=</span> <span class="va">week</span>,
         Win.Cnt <span class="op">=</span> <span class="va">win_cnt</span>,
         <span class="va">Total</span>,
         <span class="va">Day</span>,
         <span class="va">Night</span>,
         <span class="va">Reascension</span>,
         <span class="va">Unique</span><span class="op">)</span>
  
<span class="va">est_tab</span> <span class="op">%&gt;%</span>
  <span class="fu">kbl</span><span class="op">(</span>booktabs <span class="op">=</span> <span class="cn">T</span>,
      linesep <span class="op">=</span> <span class="st">""</span>,
      format.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>big.mark <span class="op">=</span> <span class="st">','</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:right;">
Week
</th>
<th style="text-align:right;">
Win.Cnt
</th>
<th style="text-align:left;">
Total
</th>
<th style="text-align:left;">
Day
</th>
<th style="text-align:left;">
Night
</th>
<th style="text-align:left;">
Reascension
</th>
<th style="text-align:left;">
Unique
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
0 (0)
</td>
<td style="text-align:left;">
0 (0)
</td>
<td style="text-align:left;">
0 (0)
</td>
<td style="text-align:left;">
0 (0)
</td>
<td style="text-align:left;">
0 (0)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
2 (2.4)
</td>
<td style="text-align:left;">
2 (2.1)
</td>
<td style="text-align:left;">
0 (0.5)
</td>
<td style="text-align:left;">
0 (0.7)
</td>
<td style="text-align:left;">
2 (2)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
2 (1.8)
</td>
<td style="text-align:left;">
1 (1.7)
</td>
<td style="text-align:left;">
0 (0.3)
</td>
<td style="text-align:left;">
0 (0.5)
</td>
<td style="text-align:left;">
1 (1.6)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
1 (1.6)
</td>
<td style="text-align:left;">
1 (1.5)
</td>
<td style="text-align:left;">
0 (0.2)
</td>
<td style="text-align:left;">
0 (0.4)
</td>
<td style="text-align:left;">
1 (1.4)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2 (1.1)
</td>
<td style="text-align:left;">
2 (1)
</td>
<td style="text-align:left;">
0 (0.2)
</td>
<td style="text-align:left;">
0 (0.3)
</td>
<td style="text-align:left;">
2 (1)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
5 (2.1)
</td>
<td style="text-align:left;">
5 (1.9)
</td>
<td style="text-align:left;">
0 (0.5)
</td>
<td style="text-align:left;">
0 (0.6)
</td>
<td style="text-align:left;">
5 (1.9)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:left;">
96 (17.4)
</td>
<td style="text-align:left;">
90 (16)
</td>
<td style="text-align:left;">
6 (3.6)
</td>
<td style="text-align:left;">
8 (5.7)
</td>
<td style="text-align:left;">
88 (16.9)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
428
</td>
<td style="text-align:left;">
446 (68.8)
</td>
<td style="text-align:left;">
420 (64.3)
</td>
<td style="text-align:left;">
25 (11.2)
</td>
<td style="text-align:left;">
32 (17)
</td>
<td style="text-align:left;">
414 (66)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
2,411
</td>
<td style="text-align:left;">
2620 (438.3)
</td>
<td style="text-align:left;">
2473 (411.2)
</td>
<td style="text-align:left;">
147 (49.8)
</td>
<td style="text-align:left;">
152 (58.5)
</td>
<td style="text-align:left;">
2468 (413.2)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
19,747
</td>
<td style="text-align:left;">
18266 (1842.3)
</td>
<td style="text-align:left;">
17225 (1737.5)
</td>
<td style="text-align:left;">
1041 (192.4)
</td>
<td style="text-align:left;">
1293 (226.3)
</td>
<td style="text-align:left;">
16972 (1724.4)
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
28,800
</td>
<td style="text-align:left;">
27870 (2458)
</td>
<td style="text-align:left;">
25814 (2280.3)
</td>
<td style="text-align:left;">
2056 (299.2)
</td>
<td style="text-align:left;">
1083 (229.9)
</td>
<td style="text-align:left;">
26787 (2369.2)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
16,565
</td>
<td style="text-align:left;">
16730 (1476.2)
</td>
<td style="text-align:left;">
15570 (1372.5)
</td>
<td style="text-align:left;">
1160 (190.7)
</td>
<td style="text-align:left;">
1466 (228.3)
</td>
<td style="text-align:left;">
15264 (1369.3)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
8,634
</td>
<td style="text-align:left;">
9784 (1606.3)
</td>
<td style="text-align:left;">
8885 (1453.2)
</td>
<td style="text-align:left;">
899 (204)
</td>
<td style="text-align:left;">
1054 (219.6)
</td>
<td style="text-align:left;">
8730 (1442.7)
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
7,398
</td>
<td style="text-align:left;">
7387 (776.1)
</td>
<td style="text-align:left;">
6715 (705.9)
</td>
<td style="text-align:left;">
673 (123.7)
</td>
<td style="text-align:left;">
681 (122.5)
</td>
<td style="text-align:left;">
6707 (712)
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
6,641
</td>
<td style="text-align:left;">
7036 (699.8)
</td>
<td style="text-align:left;">
6550 (648.8)
</td>
<td style="text-align:left;">
486 (91.5)
</td>
<td style="text-align:left;">
484 (94.9)
</td>
<td style="text-align:left;">
6552 (657.5)
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
5,768
</td>
<td style="text-align:left;">
6571 (777.4)
</td>
<td style="text-align:left;">
6221 (736.5)
</td>
<td style="text-align:left;">
350 (81.2)
</td>
<td style="text-align:left;">
357 (83.9)
</td>
<td style="text-align:left;">
6214 (739.2)
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
4,811
</td>
<td style="text-align:left;">
5664 (700.9)
</td>
<td style="text-align:left;">
5378 (663.3)
</td>
<td style="text-align:left;">
285 (72.7)
</td>
<td style="text-align:left;">
323 (78.5)
</td>
<td style="text-align:left;">
5341 (663.5)
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
4,081
</td>
<td style="text-align:left;">
4247 (480.3)
</td>
<td style="text-align:left;">
3980 (447.1)
</td>
<td style="text-align:left;">
267 (66.9)
</td>
<td style="text-align:left;">
261 (68.6)
</td>
<td style="text-align:left;">
3986 (456.2)
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
4,197
</td>
<td style="text-align:left;">
4523 (718.5)
</td>
<td style="text-align:left;">
4248 (663.3)
</td>
<td style="text-align:left;">
275 (123.5)
</td>
<td style="text-align:left;">
249 (135.4)
</td>
<td style="text-align:left;">
4274 (692.1)
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
2,698
</td>
<td style="text-align:left;">
2921 (455)
</td>
<td style="text-align:left;">
2735 (411.9)
</td>
<td style="text-align:left;">
186 (131.8)
</td>
<td style="text-align:left;">
163 (121.8)
</td>
<td style="text-align:left;">
2758 (448.3)
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1,265
</td>
<td style="text-align:left;">
1380 (228.9)
</td>
<td style="text-align:left;">
1288 (201.5)
</td>
<td style="text-align:left;">
92 (73.1)
</td>
<td style="text-align:left;">
79 (72.9)
</td>
<td style="text-align:left;">
1301 (226)
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
382
</td>
<td style="text-align:left;">
429 (78.7)
</td>
<td style="text-align:left;">
400 (67.6)
</td>
<td style="text-align:left;">
30 (30.3)
</td>
<td style="text-align:left;">
24 (23.6)
</td>
<td style="text-align:left;">
405 (78.1)
</td>
</tr>
<tr>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
430
</td>
<td style="text-align:left;">
496 (83.6)
</td>
<td style="text-align:left;">
461 (73.5)
</td>
<td style="text-align:left;">
35 (32.4)
</td>
<td style="text-align:left;">
27 (28.8)
</td>
<td style="text-align:left;">
469 (84)
</td>
</tr>
<tr>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
318
</td>
<td style="text-align:left;">
363 (60.9)
</td>
<td style="text-align:left;">
338 (52.5)
</td>
<td style="text-align:left;">
25 (24.7)
</td>
<td style="text-align:left;">
19 (19.7)
</td>
<td style="text-align:left;">
344 (60.8)
</td>
</tr>
</tbody>
</table>
<p>A user might also like to make time-series plots of estimates, to compare with window counts and/or trap estimates (Figure @ref(fig:time-series_plot)).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">week_est</span> <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">'^X.all'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
         week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[0-9]+"</span><span class="op">)</span><span class="op">)</span>,
         param <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[:alpha:]+"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,
         param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">param</span> <span class="op">==</span> <span class="st">''</span>, <span class="st">'all'</span>, <span class="va">param</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tbl_df</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">var</span>, <span class="va">param</span>, <span class="va">week</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'week'</span> <span class="op">=</span> <span class="st">'week_num'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot time-series of model estimates, window counts and trap estimates</span>
<span class="va">week_est</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">param</span> <span class="op">==</span> <span class="st">'all'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Start_Date</span>,
             y <span class="op">=</span> <span class="va">`50%`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`2.5%`</span>,
                  ymax <span class="op">=</span> <span class="va">`97.5%`</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">win_cnt</span> <span class="op">/</span> <span class="op">(</span><span class="va">day_tags</span> <span class="op">/</span> <span class="va">tot_tags</span><span class="op">)</span>,
                color <span class="op">=</span> <span class="st">'Window (adj)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">win_cnt</span> <span class="op">/</span> <span class="op">(</span><span class="va">day_tags</span> <span class="op">/</span> <span class="va">tot_tags</span><span class="op">)</span>,
                 color <span class="op">=</span> <span class="st">'Window (adj)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">win_cnt</span>,
                color <span class="op">=</span> <span class="st">'Window (raw)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">win_cnt</span>,
                 color <span class="op">=</span> <span class="st">'Window (raw)'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">trap_est</span>,
                color <span class="op">=</span> <span class="st">'Trap'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">trap_est</span>,
                 color <span class="op">=</span> <span class="st">'Trap'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Model'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Model'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Model'</span> <span class="op">=</span> <span class="st">'black'</span>,
                                <span class="st">'Window (raw)'</span> <span class="op">=</span> <span class="st">'lightblue'</span>,
                                <span class="st">'Window (adj)'</span> <span class="op">=</span> <span class="st">'blue'</span>,
                                <span class="st">'Trap'</span> <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Date'</span>,
       y <span class="op">=</span> <span class="st">'Estimate'</span>,
       color <span class="op">=</span> <span class="st">'Source'</span>,
       title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'All'</span>, <span class="va">spp</span>, <span class="st">'in'</span>, <span class="va">yr</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="STADEM-vignette_files/figure-html/time-series_plot-1.png" alt="Time-series plot showing estimates of total escapement for Chinook in 2014, including raw window counts, window counts adjusted for nighttime passage, trap estimates and STADEM estimates." width="672"><p class="caption">
Time-series plot showing estimates of total escapement for Chinook in 2014, including raw window counts, window counts adjusted for nighttime passage, trap estimates and STADEM estimates.
</p>
</div>
<p>It’s also possible to examine estimates of night-time passage or re-ascension rates. The plot below shows the observed values as points, the estimated rates as lines, with 95% credible intervals around them.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rate_est</span> <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^day.true'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> 
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">'^reasc.true'</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>,
         week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">str_extract</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[0-9]+"</span><span class="op">)</span><span class="op">)</span>,
         param <span class="op">=</span> <span class="fu">str_extract_all</span><span class="op">(</span><span class="va">var</span>, <span class="st">"[:alpha:]+"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tbl_df</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">var</span>, <span class="va">param</span>, <span class="va">week</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'week'</span> <span class="op">=</span> <span class="st">'week_num'</span><span class="op">)</span><span class="op">)</span>

<span class="va">rate_est</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Start_Date</span>,
             y <span class="op">=</span> <span class="va">`50%`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`2.5%`</span>,
                  ymax <span class="op">=</span> <span class="va">`97.5%`</span>,
                  fill <span class="op">=</span> <span class="va">param</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">param</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">day_tags</span> <span class="op">/</span> <span class="va">tot_tags</span>,
                 color <span class="op">=</span> <span class="st">'day'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">reascent_tags</span> <span class="op">/</span> <span class="va">tot_tags</span>,
                 color <span class="op">=</span> <span class="st">'reasc'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_color_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Set1'</span>,
                     name <span class="op">=</span> <span class="st">'Rate'</span>,
                     labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'day'</span> <span class="op">=</span> <span class="st">'Daytime Passage'</span>,
                                <span class="st">'reasc'</span> <span class="op">=</span> <span class="st">'Reascension'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Set1'</span>,
                    name <span class="op">=</span> <span class="st">'Rate'</span>,
                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'day'</span> <span class="op">=</span> <span class="st">'Daytime Passage'</span>,
                               <span class="st">'reasc'</span> <span class="op">=</span> <span class="st">'Reascension'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Estimate'</span>,
       x <span class="op">=</span> <span class="st">'Date'</span>,
       title <span class="op">=</span> <span class="st">'Estimated Rates'</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="STADEM-vignette_files/figure-html/unnamed-chunk-2-1.png" alt="Time-series of estimated day-time passage (red) and re-ascension (blue) rates, with points representing the observed data and shaded polygons represeneting the 95% credible intervals." width="672"><p class="caption">
Time-series of estimated day-time passage (red) and re-ascension (blue) rates, with points representing the observed data and shaded polygons represeneting the 95% credible intervals.
</p>
</div>
</div>
<div id="additional-options" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-options" class="anchor"></a>Additional options</h1>
<p>The user does have the option to not use fish caught in the trap as a secondary estimate of escapement. To turn this feature off, set the argument <code>trap_est</code> equal to <code>FALSE</code> in the <code>runSTADEMmodel</code> function. This will constrain the statistical distribution used to model the window counts as Poisson, because there is no other way to estimate the variance in those counts.</p>
<p>If the user would like to summarize STADEM estimates of total unique escapement, by week, (e.g. as an input to the <a href="https://github.com/mackerman44/SCOBI"><code>SCOBI</code> package</a>), there is a function to do that, <code>STADEMtoSCOBI</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scobi_input</span> <span class="op">=</span> <span class="fu"><a href="../reference/STADEMtoSCBOI.html">STADEMtoSCBOI</a></span><span class="op">(</span>stadem_mod <span class="op">=</span> <span class="va">mod</span>,
                            lgr_weekly <span class="op">=</span> <span class="va">stadem_list</span><span class="op">[[</span><span class="st">'weeklyData'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">scobi_input</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   model_week StartDate  Strata Estimate    SE Collapse
##        &lt;int&gt; &lt;date&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   
## 1          1 2014-03-01      9        0  0    NA      
## 2          2 2014-03-10     10        2  2.00 NA      
## 3          3 2014-03-17     11        1  1.59 NA      
## 4          4 2014-03-24     12        1  1.43 NA      
## 5          5 2014-03-31     13        2  1.04 NA      
## 6          6 2014-04-07     14        5  1.91 NA</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Linden2011">
<p>Lindén, Andreas, and Samu Mäntyniemi. 2011. “Using the Negative Binomial Distribution to Model Overdispersion in Ecological Count Data.” <em>Ecology</em> 92 (4): 1414–21.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin See.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
